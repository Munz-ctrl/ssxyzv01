<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content=" height=1920px , initial-scale=1.0, maximum-scale=1.0, width=1080, user-scalable=no">
  

  <link rel="stylesheet" href="css/suitcase.css">
  <title>Nomad Suitcase Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
    }
    #gameContainer {
  width: auto;
  height: 100vh;
  aspect-ratio: 9/16;
  max-height: 100vh;
  max-width: 1080px;
  margin: auto;
  background: black;
  position: relative;
  overflow: hidden;
}

   video#gameVideo {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

    .click-area, #itemGrid, #itemOverlay, #closeSuitcaseBtn {
      position: absolute;
      z-index: 2;
    }
    #suitcaseBtn {
      bottom: 220px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 60px;
      background: transparent;
      border: none;
      cursor: pointer;
    }
    #itemGrid {
      display: none;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
    }
    #itemOverlay {
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      display: none;
      font-size: 12px;
      text-align: center;
    }
    #closeSuitcaseBtn {
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      color: white;
      padding: 4px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <video id="gameVideo" src="assets/suitcase/nomad_seq.mp4" preload="auto" playsinline muted></video>

    <button id="suitcaseBtn" class="click-area"></button>
    <div id="itemGrid" class="item-grid"></div>
    <div id="itemOverlay"></div>
    <button id="closeSuitcaseBtn">Close Suitcase</button>
  </div>

  <script type="module">
    const video = document.getElementById('gameVideo');
    const itemGrid = document.getElementById('itemGrid');
    const overlay = document.getElementById('itemOverlay');
    const suitcaseBtn = document.getElementById('suitcaseBtn');
    const closeBtn = document.getElementById('closeSuitcaseBtn');

    const states = {
      IDLE: [0, 230],
      TO_SUITCASE: [320, 478],
      SUITCASE_LOOP: [454, 478],
      EXIT_SUITCASE: [478, 646]
    };

    let state = 'IDLE';
    let transitionTimeout;
    let allowClick = true;

    function toTime(frame) {
      return frame / 30;
    }

    function playSegment(startFrame, endFrame, callback) {
      clearTimeout(transitionTimeout);
      allowClick = false;
      video.currentTime = toTime(startFrame);
      video.play();
      const duration = toTime(endFrame - startFrame);
      transitionTimeout = setTimeout(() => {
        video.pause();
        video.currentTime = toTime(endFrame);
        allowClick = true;
        if (callback) callback();
      }, duration * 1000);
    }

    function loopSegment(startFrame, endFrame) {
      video.currentTime = toTime(startFrame);
      video.play();
      const loopStart = toTime(startFrame);
      const loopEnd = toTime(endFrame);
      video.ontimeupdate = () => {
        if (video.currentTime >= loopEnd) video.currentTime = loopStart;
      };
    }

    function pauseAtFrame(frame) {
      video.currentTime = toTime(frame);
      video.pause();
    }

    suitcaseBtn.onclick = () => {
      if (!allowClick || state !== 'IDLE') return;
      state = 'OPENING';
      playSegment(...states.TO_SUITCASE, () => {
        state = 'SUITCASE';
        pauseAtFrame(478); // or loopSegment(454, 478);
        itemGrid.style.display = 'grid';
        closeBtn.style.display = 'block';
      });
    };

    closeBtn.onclick = () => {
      if (!allowClick || state !== 'SUITCASE') return;
      state = 'CLOSING';
      itemGrid.style.display = 'none';
      overlay.style.display = 'none';
      closeBtn.style.display = 'none';
      playSegment(...states.EXIT_SUITCASE, () => {
        state = 'IDLE';
        video.currentTime = toTime(states.IDLE[0]);
        video.play();
      });
    };

    async function loadItems() {
      const res = await fetch('data/suitcaseItems.json');
      const items = await res.json();
      const totalSlots = 18;
      itemGrid.innerHTML = '';

      for (let i = 0; i < totalSlots; i++) {
        const slot = document.createElement('div');
        slot.className = 'item-slot';

        const item = items[i];
        if (item) {
          const img = document.createElement('img');
          img.src = item.image;
          img.alt = item.name;
          slot.appendChild(img);
          slot.onclick = () => {
            overlay.innerHTML = `<strong>${item.name}</strong><br><a href="${item.link}" target="_blank">View</a>`;
            overlay.style.display = 'block';
          };
        } else {
          const plus = document.createElement('span');
          plus.textContent = '+';
          slot.appendChild(plus);
        }

        itemGrid.appendChild(slot);
      }
    }

    loadItems();
    playSegment(...states.IDLE, () => {
  loopSegment(...states.IDLE);
});


  </script>
</body>
</html>
